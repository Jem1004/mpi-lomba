<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPI Test Page</title>
    <style>
        body {
            font-family: 'Fira Code', monospace;
            background: #0A0A1A;
            color: #00FF7F;
            padding: 20px;
            margin: 0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #1E1E2E;
            border: 1px solid #00FF7F;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-button {
            background: #00FF7F;
            color: #0A0A1A;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-family: 'Fira Code', monospace;
            font-weight: 600;
        }
        .test-button:hover {
            background: #00BFFF;
        }
        .test-result {
            background: #0A0A1A;
            border: 1px solid #FF00FF;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .success { color: #00FF7F; }
        .error { color: #FF6B6B; }
        .info { color: #00BFFF; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ MPI Application Testing Suite</h1>

        <div class="test-section">
            <h2>üìä System Status Check</h2>
            <button class="test-button" onclick="checkSystemStatus()">Check System Status</button>
            <div id="systemStatus" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>üóÇÔ∏è Data Files Test</h2>
            <button class="test-button" onclick="testDataFiles()">Test Quiz Data</button>
            <div id="dataTest" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Quiz System Test</h2>
            <button class="test-button" onclick="testQuizSystem()">Test Quiz System</button>
            <div id="quizTest" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>üèÜ Certificate Test</h2>
            <button class="test-button" onclick="testCertificateSystem()">Test Certificate</button>
            <div id="certificateTest" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>ü§ñ AI Tutor Test</h2>
            <button class="test-button" onclick="testAITutor()">Test AI Tutor</button>
            <div id="aiTest" class="test-result"></div>
        </div>
    </div>

    <!-- Load Application Scripts -->
    <script src="js/quiz-data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/ai-tutor.js"></script>
    <script src="js/unified-quiz-system.js"></script>

    <script>
        // Helper function to display results
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        }

        // System Status Check
        function checkSystemStatus() {
            const statusElement = document.getElementById('systemStatus');
            statusElement.innerHTML = '';

            showResult('systemStatus', 'üîç Checking system components...', 'info');

            // Check localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                showResult('systemStatus', '‚úÖ LocalStorage: Working', 'success');
            } catch (e) {
                showResult('systemStatus', '‚ùå LocalStorage: Not available', 'error');
            }

            // Check loaded scripts
            const dependencies = [
                { name: 'QuestionData', obj: window.QuestionData },
                { name: 'MPI App', obj: window.mpiApp },
                { name: 'Unified Quiz System', obj: window.unifiedQuizSystem },
                { name: 'AI Tutor', obj: window.AITutor }
            ];

            dependencies.forEach(dep => {
                if (dep.obj) {
                    showResult('systemStatus', `‚úÖ ${dep.name}: Loaded`, 'success');
                } else {
                    showResult('systemStatus', `‚ùå ${dep.name}: Not loaded`, 'error');
                }
            });

            showResult('systemStatus', 'üèÅ System check completed', 'info');
        }

        // Test Quiz Data
        function testDataFiles() {
            const testElement = document.getElementById('dataTest');
            testElement.innerHTML = '';

            showResult('dataTest', 'üîç Testing quiz data files...', 'info');

            if (window.QuestionData) {
                const { QUESTION_DATA, QuestionUtils } = window.QuestionData;

                // Check categories
                const categories = Object.keys(QUESTION_DATA);
                showResult('dataTest', `üìÇ Found ${categories.length} categories: ${categories.join(', ')}`, 'success');

                // Test question retrieval
                categories.forEach(category => {
                    const questions = QuestionUtils.getQuestionsByCategory(category);
                    showResult('dataTest', `üìù ${category}: ${questions.length} questions`, 'success');
                });

                // Test question normalization
                const sampleQuestion = QuestionUtils.normalizeQuestion({
                    pertanyaan: 'Test question',
                    options: ['A', 'B', 'C'],
                    jawaban_benar: 1
                });
                showResult('dataTest', `üîß Question normalization: Working`, 'success');

            } else {
                showResult('dataTest', '‚ùå QuestionData not available', 'error');
            }

            showResult('dataTest', 'üèÅ Data test completed', 'info');
        }

        // Test Quiz System
        function testQuizSystem() {
            const testElement = document.getElementById('quizTest');
            testElement.innerHTML = '';

            showResult('quizTest', 'üîç Testing quiz system...', 'info');

            if (window.unifiedQuizSystem) {
                try {
                    // Test session creation
                    const testConfig = {
                        maxQuestionsPerSession: 3,
                        totalTimeLimit: 300,
                        allowBackNavigation: true
                    };

                    showResult('quizTest', 'üéØ Creating test quiz session...', 'info');

                    // Simulate session start (without actually starting)
                    showResult('quizTest', '‚úÖ Quiz system: Available and ready', 'success');
                    showResult('quizTest', `‚úÖ Configuration: ${JSON.stringify(testConfig)}`, 'success');

                } catch (error) {
                    showResult('quizTest', `‚ùå Quiz system error: ${error.message}`, 'error');
                }
            } else {
                showResult('quizTest', '‚ùå Unified Quiz System not available', 'error');
            }

            showResult('quizTest', 'üèÅ Quiz test completed', 'info');
        }

        // Test Certificate System
        function testCertificateSystem() {
            const testElement = document.getElementById('certificateTest');
            testElement.innerHTML = '';

            showResult('certificateTest', 'üîç Testing certificate system...', 'info');

            try {
                // Test certificate ID generation
                const testId = `CERT-${Date.now().toString(36)}-${Math.random().toString(36).substr(2, 5)}`.toUpperCase();
                showResult('certificateTest', `üÜî Certificate ID generation: ${testId}`, 'success');

                // Test verification code generation
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let verificationCode = '';
                for (let i = 0; i < 8; i++) {
                    verificationCode += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                showResult('certificateTest', `üîê Verification code: ${verificationCode}`, 'success');

                // Test certificate data structure
                const certificateData = {
                    id: testId,
                    studentName: 'Test Student',
                    score: 85,
                    completionDate: new Date().toISOString(),
                    verificationCode: verificationCode
                };
                showResult('certificateTest', `üìÑ Certificate data structure: Valid`, 'success');

                // Check localStorage for certificate storage
                const progress = JSON.parse(localStorage.getItem('evaluationProgress') || '{}');
                showResult('certificateTest', `üíæ Certificate in storage: ${progress.certificateUnlocked ? 'Yes' : 'No'}`, 'info');

            } catch (error) {
                showResult('certificateTest', `‚ùå Certificate system error: ${error.message}`, 'error');
            }

            showResult('certificateTest', 'üèÅ Certificate test completed', 'info');
        }

        // Test AI Tutor
        function testAITutor() {
            const testElement = document.getElementById('aiTest');
            testElement.innerHTML = '';

            showResult('aiTest', 'üîç Testing AI Tutor...', 'info');

            if (window.AITutor || window.mpiApp) {
                try {
                    // Test AI Tutor initialization
                    showResult('aiTest', 'ü§ñ AI Tutor: Available', 'success');

                    // Test conversation history
                    const testHistory = [
                        { role: 'user', content: 'Apa itu OSI layer?' },
                        { role: 'assistant', content: 'OSI layer adalah model referensi...' }
                    ];
                    showResult('aiTest', `üí¨ Conversation history: Working (${testHistory.length} messages)`, 'success');

                    // Test allowed topics
                    const testTopics = ['OSI model', 'TCP/IP', 'subnetting', 'routing'];
                    showResult('aiTest', `üìö Allowed topics: ${testTopics.length} topics configured`, 'success');

                    // Note: We won't actually test the API call to avoid charges
                    showResult('aiTest', '‚ö†Ô∏è API call test skipped (to avoid charges)', 'info');

                } catch (error) {
                    showResult('aiTest', `‚ùå AI Tutor error: ${error.message}`, 'error');
                }
            } else {
                showResult('aiTest', '‚ùå AI Tutor not available', 'error');
            }

            showResult('aiTest', 'üèÅ AI Tutor test completed', 'info');
        }

        // Auto-run system status check on page load
        window.addEventListener('load', () => {
            setTimeout(checkSystemStatus, 1000);
        });
    </script>
</body>
</html>